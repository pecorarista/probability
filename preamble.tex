\usepackage{graphicx}
\usepackage{booktabs}
\usepackage[%
    hang,
    flushmargin
]{footmisc}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
% \usepackage{mtpro2}
\usepackage{bussproofs}
\usepackage[
    math-style=ISO
]{unicode-math}
\usepackage{customdice}
\usepackage{tikz}
\usepackage{tikz-qtree}
\usepackage{pgfplots}
\usetikzlibrary{%
    patterns,
    intersections,
    calc,
    angles,
    quotes
}

\usepackage{xcolor}
\definecolor{sBlue}{HTML}{0095D9}
\colorlet{sOriginalCurve}{sBlue}

\definecolor{sRed}{HTML}{FF0033}
\colorlet{sApproxCurve}{sRed}

\definecolor{sGreen}{HTML}{138D75}
\colorlet{sSimpleCurve}{sGreen}

\definecolor{sFill}{HTML}{00A381}
\definecolor{sLightGray}{gray}{0.85}

\usepackage{emoji}
\usepackage{framed}

\usepackage[
    % no-math
]{fontspec}
\usepackage[
    deluxe,%
    expert,
    scale=0.95
]{luatexja-preset}

\usepackage{polyglossia}
\setdefaultlanguage{japanese}
\setotherlanguages{english,french,german,russian,hebrew,greek}

\usepackage{covington}
\setglossoptions{%
    fstl=\normalfont\upshape\rmfamily\mcfamily,
    enquotetl=false,
}

\usepackage{luatexja-ruby}
% \setmainfont[%
%     Extension=.otf,
%     UprightFont=*-Book,
%     UprightFont=*-Regular,
%     ItalicFont=*-Italic,
%     BoldFont=*-Bold,
%     BoldItalicFont=*-BoldItalic,
%     SmallCapsFeatures={Numbers=OldStyle},
% ]{NewCM10}
\setmainfont[%
    Extension=.ttf,
    UprightFont=*MT,
    ItalicFont=*-ItalicMT,
    BoldFont=*-BoldMT,
    BoldItalicFont=*-BoldItalicMT,
    Ligatures=Discretionary
]{TimesNewRomanPS}
% \setmainfont{STIX Two Text}
\setsansfont[
    Extension=.ttf,
    UprightFont=*-Regular,
    BoldFont=*-Medium
]{Roboto}
% \setmathfont[
%    math-style=ISO,
%    StylisticSet=1
% ]{STIX Two Math}
\setmathfont{NewCMMath-Book.otf}
\setmathfont[%
    range={%
        cal,
        bfcal
    },
    StylisticSet=1
]{KpMath-Regular.otf}

\ltjnewpreset{book}{%
    mc-m = A-OTF-RyuminPro-Regular.otf,
    % mc-m = NotoSerifJP-Regular.otf,
    % mc-m = HiraMinProN-W3.otf,
    gt-m = BIZUDGothic-Regular.ttf,
    gt-b = BIZUDGothic-Bold.ttf,
    mg-m = MotoyaMaruStd-W5.otf
}
\ltjapplypreset{book}
\setmonojfont{HiraMaruProN-W4}
\ltjsetparameter{%
    jacharrange={%
        -2, % Exclude Greek and Cyrillic letters.
        -3, % Punctuations and miscellaneous symbols.
        -7  % other CJK characters
    },
    alxspmode={`/,allow},
    alxspmode={`#,allow},
    alxspmode={92,allow} % backslash
}

\usepackage{wtref}
\newref{fig}
\setrefstyle{fig}{prefix=図}
\newref{eq}
\setrefstyle{eq}{prefix=式(, suffix=)}
\newref{definition}
\setrefstyle{definition}{prefix=定義}
\newref{axiom}
\setrefstyle{axiom}{prefix=公理}
\newref{proposition}
\setrefstyle{proposition}{prefix=命題}
\newref{lemma}
\setrefstyle{lemma}{prefix=補題}
\newref{example}
\setrefstyle{example}{prefix=例}
\newref{theorem}
\setrefstyle{theorem}{prefix=定理}
\newref{sec}
\setrefstyle{sec}{prefix={第},suffix={節}}

\newtheoremstyle{jplain}%
    {0.6\baselineskip}%
    {0.6\baselineskip}%
    {\normalfont}%
    {}%
    {\bfseries\gtfamily\sffamily}%
    {}%
    {5pt}%
    {\thmname{#1}\thmnumber{#2}\thmnote{#3}\ignorespaces}
\theoremstyle{jplain}
\newtheorem{theorem}{定理}[chapter]
\newtheorem{proposition}[theorem]{命題}
\newtheorem{lemma}[theorem]{補題}
\newtheorem{definition}[theorem]{定義}
\newtheorem{exa}[theorem]{例}
\newtheorem{axiom}[theorem]{公理}
\newtheorem{numberedquote}[theorem]{引用}
\renewcommand{\proofname}{証明}
\renewcommand{\qedsymbol}{\rule{5pt}{10pt}}

\usepackage{tcolorbox}
\tcbuselibrary{%
    skins,
    breakable
}
\newtcolorbox{thmbox}{%
    colback=sLightGray,
    top=8pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    boxrule=0pt,
    sharp corners,
    frame hidden
}
\newtcolorbox{quotebox}{%
    breakable,
    colback=sLightGray,
    top=8pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    boxrule=0pt,
    sharp corners,
    frame hidden
}

\makeatletter
\renewenvironment{proof}[1][\proofname]{\par
  \pushQED{\qed}%
  \normalfont \topsep6\p@\@plus6\p@\relax
  \trivlist
  \item[\hskip\labelsep\bfseries\gtfamily#1]\ignorespaces
}{%
  \popQED\endtrivlist\@endpefalse
}
\makeatother
\AtBeginDocument{%
  \setlength{\abovedisplayskip}{5pt}%
  \setlength{\belowdisplayskip}{5pt}%
}

% https://note.com/yuw/n/n38dd54fb2169
\begingroup
\catcode`\,=\active
\def\@x@{\def,{\normalcomma\hskip.2em}}
\expandafter\endgroup\@x@%
\mathcode`\,="8000
\def\normalcomma{\mathchar"613B}

\usepackage{enumitem}
\newlist{conditions}{enumerate}{1}
\setlist[conditions]{label=(\arabic*)}

\newlist{inproofconditions}{enumerate}{1}
\setlist[inproofconditions]{label=(\alph*)}

\usepackage{hyperref}
\hypersetup{%
    colorlinks,
    citecolor=sBlue,
    linkcolor=sBlue,
    urlcolor=sBlue
}

\usepackage[%
    backend=biber,
    style=pecorarista,
    sorting=nyvt,
    urldate=long
]{biblatex}
\addbibresource{references.bib}

\newcommand\mainchapter[1]{\chapter{#1}\thispagestyle{empty}}
\renewcommand{\jsParagraphMark}{}
\renewcommand{\headfont}{\bfseries\gtfamily\sffamily}

\newcommand\tuple[1]{(#1)}
\newcommand\keyword[1]{{\bfseries\gtfamily #1}}
\newcommand\emphchar[1]{\ltjalchar`‹#1\ltjalchar`›}

\newcommand\NaturalNumber{\symbb{N}}
\newcommand\Integer{\symbb{Z}}
\newcommand\PositiveInteger{\symbb{N}_{\mathord{+}}}
\newcommand\Sequence[2]{{\langle {#1}_{#2} \rangle}_{#2 \in \PositiveInteger}}
\newcommand\Subsequence[1]{{\langle {#1}_{\varphi(n)} \rangle}_{n \in \PositiveInteger}}
\newcommand\Sequencen[1]{{\langle {#1}_n \rangle}_{n \in \PositiveInteger}}
\newcommand\SimpleSequencen[1]{{\langle {#1}_n \rangle}_{n}}
\newcommand\Family[1]{{({#1}_\lambda)}_{\lambda \in \Lambda}}
\newcommand\NonNegReal{\symbb{R}_{\mathord{+}}}
\newcommand\PositiveReal{\symbb{R}_{\mathord{+}\mathord{+}}}
\newcommand\Generatedtopology[1]{\tau\left[#1\right]}
\newcommand\Neighborhood[1]{\symcal{N}(#1)}
\newcommand\OpenNeighborhood[1]{\symcal{U}(#1)}

\newcommand\placeholder{\mathord{\cdot}}
\newcommand\powerset[1]{\wp(#1)}
\newcommand\inlinefrac[2]{#1\mathbin{/}#2}
\newcommand\setcomp[1]{{#1}^{\mathsf{c}}}
% https://zrbabbler.hatenablog.com/entry/20120411/1334151482
\newcommand{\relmiddle}[1]{\mathrel{}\middle#1\mathrel{}}

\DeclareMathOperator{\identity}{id}
\DeclareMathOperator{\trace}{trace}
\DeclareMathOperator{\len}{len}
\newcommand\symdiffsymbol{\mathord{\triangle}}
\newcommand\symdiff[2]{#1\mathbin{\triangle}#2}
\newfontfamily\treefont[ItalicFont={Roboto Light Italic}]{Roboto Light}
\newfontfamily\suetterlin{Suetterlin-HJZ-Italic-1911.ttf}
\newcommand\formallang[1]{{\treefont\itshape #1}}

\newcommand\header[1]{\multicolumn{1}{c}{\bfseries\gtfamily #1}}
\newcommand\pronunciation[4]{#1 \texttt{#2} [#3] #4．}
\newcommand\primarystress{\mbox{}\char"02C8}

\newcommand\submin[1]{#1_{\text{min}}}

\newcommand\liaison{\hspace*{0.1em}\raisebox{-0.8ex}{\rotatebox{90}{(}}\hspace*{0.1em}}
\newcommand\shortunderscore{\scalebox{0.7}[1]{\_}}
\newcommand\invbreve[1]{#1{\char"032F}}
% \newcommand\symbb[1]{\mathbb{#1}}
% \newcommand\symcal[1]{\mathcal{#1}}
% \newcommand\symbf[1]{\mathbf{#1}}

\newcommand\iseventuallyin[2]{#1 \mathrel{\text{is eventually in}} #2}
\newcommand\justin[1]{\mathrel{\text{in}} #1}
\newcommand\isfrequentlyin[2]{#1 \mathrel{\text{is frequently in}} #2}
\newcommand\oxfordcomma[3]{#1, #2, \text{and }#3}

\newcommand\proofimplies[2]{\(\text{\ref{#1}} \Rightarrow \text{\ref{#2}}\)：}

\renewcommand{\labelitemii}{\(\circ\)}
\renewcommand{\labelitemiii}{\(\diamond\)}
